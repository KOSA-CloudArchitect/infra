# hihypipe EKS ì¸í”„ë¼ - Public Subnet êµ¬ì„±

## ğŸ“‹ ê°œìš”

ì´ í´ë”ëŠ” **Public Subnet ê¸°ë°˜ì˜ EKS í´ëŸ¬ìŠ¤í„°**ë¥¼ êµ¬ì„±í•˜ëŠ” Terraform ì½”ë“œì…ë‹ˆë‹¤. ë¹„ìš© ì ˆì•½ê³¼ ê°„ë‹¨í•œ êµ¬ì„±ì„ ìš°ì„ ì‹œí•˜ë©°, ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ì™€ ê°œë°œ í™˜ê²½ì— ì í•©í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
Internet
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VPC-APP                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Public Subnets â”‚  â”‚      Private Subnets        â”‚  â”‚
â”‚  â”‚   (EKS Nodes)   â”‚  â”‚      (Future Apps)          â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  Internet       â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  Gateway        â”‚  â”‚  â”‚   EKS Cluster       â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚                     â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â”‚  Node Group   â”‚  â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â”‚  (t3.medium)  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VPC-DB                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Private Subnets                        â”‚ â”‚
â”‚  â”‚              (Database Only)                        â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚              RDS Subnet Group               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚              (AZ-a, AZ-b)                   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ¨ ì£¼ìš” íŠ¹ì§•

### **ğŸ’° ë¹„ìš© ìµœì í™”**
- **NAT Gateway ë¹„í™œì„±í™”**: ì›” ë¹„ìš© ì ˆì•½ (~$45/ì›”)
- **EKS ë…¸ë“œ**: Public Subnetì— ì§ì ‘ ë°°ì¹˜
- **ì™¸ë¶€ ì¸í„°ë„· ì ‘ê·¼**: ì§ì ‘ ì—°ê²°ë¡œ VPC Endpoints ë¶ˆí•„ìš”
- **ê°„ë‹¨í•œ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±**: ë³µì¡í•œ ë¼ìš°íŒ… ì„¤ì • ë¶ˆí•„ìš”

### **ğŸš€ ë¹ ë¥¸ ë°°í¬**
- **ê°„ë‹¨í•œ êµ¬ì„±**: ìµœì†Œí•œì˜ ì„¤ì •ìœ¼ë¡œ ë¹ ë¥¸ ë°°í¬
- **ìë™ ì„¤ì •**: EKS ëª¨ë“ˆì´ ëª¨ë“  ì„¤ì •ì„ ìë™ ì²˜ë¦¬
- **ì§ì ‘ ì ‘ê·¼**: ì™¸ë¶€ì—ì„œ EKS API ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥

### **ğŸŒ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±**
- **VPC-APP**: Public + Private Subnet
- **VPC-DB**: Private Subnetë§Œ (ì™„ì „ ê²©ë¦¬)
- **VPC Peering**: App â†” DB ê°„ í†µì‹ 
- **Route Tables**: ìë™ êµ¬ì„±

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
terraform_public/
â”œâ”€â”€ main.tf                    # VPC, Security Groups, VPC Peering
â”œâ”€â”€ eks.tf                     # EKS Cluster ë° Node Groups
â”œâ”€â”€ variables.tf               # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ outputs.tf                 # ì¶œë ¥ê°’ ì •ì˜
â”œâ”€â”€ terraform.tfvars.example   # ë³€ìˆ˜ ì˜ˆì‹œ íŒŒì¼
â”œâ”€â”€ README.md                  # ì´ íŒŒì¼
â””â”€â”€ EKS_DEPLOYMENT_ANALYSIS.md # ë°°í¬ ë¶„ì„ ë³´ê³ ì„œ
```

## ğŸš€ ì‹œì‘í•˜ê¸°

### **1. ì‚¬ì „ ìš”êµ¬ì‚¬í•­**
```bash
# AWS CLI ì„¤ì •
aws configure

# Terraform ì„¤ì¹˜ (>= 1.0)
terraform version
```

### **2. ë³€ìˆ˜ ì„¤ì •**
```bash
# ì˜ˆì‹œ íŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì •
cp terraform.tfvars.example terraform.tfvars

# terraform.tfvars íŒŒì¼ í¸ì§‘
vim terraform.tfvars
```

### **3. ë°°í¬ ì‹¤í–‰**
```bash
# ì´ˆê¸°í™”
terraform init

# ê³„íš í™•ì¸
terraform plan

# ë°°í¬ ì‹¤í–‰
terraform apply
```

### **4. EKS ì ‘ê·¼**
```bash
# kubeconfig ì—…ë°ì´íŠ¸
aws eks update-kubeconfig --region ap-northeast-2 --name hihypipe-cluster

# í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
kubectl get nodes
kubectl get pods --all-namespaces
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

### **ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­**
- **Public Subnet**: EKS ë…¸ë“œê°€ ì™¸ë¶€ ì¸í„°ë„·ì— ì§ì ‘ ë…¸ì¶œ
- **Public Endpoint**: EKS APIê°€ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
- **ë³´ì•ˆ ê·¸ë£¹**: ì ì ˆí•œ ì¸ë°”ìš´ë“œ ê·œì¹™ ì„¤ì • í•„ìš”
- **í”„ë¡œë•ì…˜ í™˜ê²½**: ì¶”ê°€ ë³´ì•ˆ ì„¤ì • ê¶Œì¥

### **ğŸŒ ë„¤íŠ¸ì›Œí¬ ì¥ì **
- **ì™¸ë¶€ ì ‘ê·¼**: NAT Gateway ì—†ì´ ì§ì ‘ ì¸í„°ë„· ì ‘ê·¼
- **EKS API**: ì™¸ë¶€ì—ì„œ ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥
- **ê°„ë‹¨í•œ êµ¬ì„±**: ë³µì¡í•œ VPC Endpoints ì„¤ì • ë¶ˆí•„ìš”

### **ğŸ’° ë¹„ìš© ì ˆì•½**
- **NAT Gateway**: ë¹„í™œì„±í™”ë¡œ ì›” $45+ ì ˆì•½
- **VPC Endpoints**: ë¶ˆí•„ìš”ë¡œ ì¶”ê°€ ë¹„ìš© ì ˆì•½
- **ë°ì´í„° ì „ì†¡**: ì§ì ‘ ì—°ê²°ë¡œ ìš°íšŒ ë¹„ìš© ì—†ìŒ

## ğŸ”§ êµ¬ì„± ì˜µì…˜

### **VPC ì„¤ì •**
```hcl
# VPC-APP
enable_nat_gateway = false     # NAT Gateway ë¹„í™œì„±í™”
create_igw = true              # Internet Gateway í™œì„±í™”
map_public_ip_on_launch = true # Public IP ìë™ í• ë‹¹

# VPC-DB
create_igw = false             # Internet Gateway ë¹„í™œì„±í™”
enable_nat_gateway = false     # NAT Gateway ë¹„í™œì„±í™”
```

### **EKS ì„¤ì •**
```hcl
# Public Subnet ì‚¬ìš©
subnet_ids = module.vpc_app.public_subnets

# Public Endpoint í™œì„±í™”
endpoint_public_access = true

# í´ëŸ¬ìŠ¤í„° ìƒì„±ì ê¶Œí•œ
enable_cluster_creator_admin_permissions = true
```

## ğŸ“Š ë¹„ìš© ì˜ˆìƒ

### **ì›”ë³„ ì˜ˆìƒ ë¹„ìš© (ap-northeast-2)**
- **NAT Gateway**: $0/ì›” (ë¹„í™œì„±í™”)
- **EKS ë…¸ë“œ (t3.medium)**: ~$30/ì›” Ã— ë…¸ë“œ ìˆ˜
- **ë°ì´í„° ì „ì†¡**: ì‚¬ìš©ëŸ‰ì— ë”°ë¼ ë³€ë™
- **ì´ ì˜ˆìƒ**: ~$30-90/ì›” (ë…¸ë“œ ìˆ˜ì— ë”°ë¼)

### **ë¹„ìš© ì ˆì•½ íš¨ê³¼**
- **NAT Gateway ì œê±°**: ì›” $45+ ì ˆì•½
- **VPC Endpoints ì œê±°**: ì›” $7+ ì ˆì•½
- **ì´ ì ˆì•½**: ì›” $50+ ì ˆì•½

## ğŸš€ í™•ì¥ ë° ìˆ˜ì •

### **ë…¸ë“œ ê·¸ë£¹ ì¶”ê°€**
```hcl
eks_managed_node_groups = {
  app-nodes = {
    # ê¸°ì¡´ ì„¤ì •...
  }
  
  # ìƒˆë¡œìš´ ë…¸ë“œ ê·¸ë£¹ ì¶”ê°€
  worker-nodes = {
    ami_type       = "AL2023_x86_64_STANDARD"
    instance_types = ["t3.large"]
    min_size       = 2
    max_size       = 5
    desired_size   = 2
    subnet_ids     = module.vpc_app.public_subnets
  }
}
```

### **ë³´ì•ˆ ê·¸ë£¹ ê°•í™”**
```hcl
# EKS ë…¸ë“œìš© ë³´ì•ˆ ê·¸ë£¹ ì¶”ê°€
resource "aws_security_group" "eks_nodes" {
  name_prefix = "eks-nodes"
  vpc_id      = module.vpc_app.vpc_id
  
  ingress {
    from_port = 22
    to_port   = 22
    protocol  = "tcp"
    cidr_blocks = ["YOUR_IP/32"]  # íŠ¹ì • IPë§Œ í—ˆìš©
  }
}
```

## ğŸ†š Public vs Private ë¹„êµ

| êµ¬ë¶„ | Public (ì´ êµ¬ì„±) | Private |
|------|------------------|---------|
| **ë³´ì•ˆì„±** | âš ï¸ ë³´í†µ | ğŸ”’ ë†’ìŒ |
| **ë¹„ìš©** | ğŸ’° ë‚®ìŒ | ğŸ’° ë†’ìŒ (NAT Gateway) |
| **ì™¸ë¶€ ì ‘ê·¼** | ğŸŒ ì§ì ‘ ì ‘ê·¼ | ğŸ”„ NAT Gateway ìš°íšŒ |
| **ê´€ë¦¬ ë³µì¡ë„** | ğŸŸ¢ ê°„ë‹¨ | ğŸ”§ ë³µì¡ |
| **ê°œë°œ/í…ŒìŠ¤íŠ¸ ì í•©ì„±** | âœ… ë†’ìŒ | âš ï¸ ë³´í†µ |

## ğŸ”’ ë³´ì•ˆ ê°•í™” ê¶Œì¥ì‚¬í•­

### **í”„ë¡œë•ì…˜ í™˜ê²½ ì‚¬ìš© ì‹œ**
1. **IP ì œí•œ**: íŠ¹ì • IPì—ì„œë§Œ EKS API ì ‘ê·¼ í—ˆìš©
2. **ë³´ì•ˆ ê·¸ë£¹**: ìµœì†Œí•œì˜ í¬íŠ¸ë§Œ ì—´ê¸°
3. **IAM ì •ì±…**: ì„¸ë°€í•œ ê¶Œí•œ ì œì–´
4. **ëª¨ë‹ˆí„°ë§**: CloudTrail, CloudWatch ë¡œê·¸ í™œì„±í™”

### **ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½**
1. **ë¹ ë¥¸ ë°°í¬**: ê°„ë‹¨í•œ ì„¤ì •ìœ¼ë¡œ ë¹ ë¥¸ êµ¬ì„±
2. **ë¹„ìš© ì ˆì•½**: NAT Gateway ì—†ì´ ìš´ì˜
3. **ì§ì ‘ ì ‘ê·¼**: ì™¸ë¶€ì—ì„œ kubectl ëª…ë ¹ ì‹¤í–‰ ê°€ëŠ¥

## ğŸš¨ ì œí•œì‚¬í•­

### **ë³´ì•ˆ ì œí•œ**
- **ì™¸ë¶€ ë…¸ì¶œ**: EKS ë…¸ë“œê°€ Public Subnetì— ìœ„ì¹˜
- **API ì ‘ê·¼**: ì™¸ë¶€ì—ì„œ EKS API ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥
- **ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ**: ì¶”ê°€ì ì¸ ë³´ì•ˆ ì„¤ì • í•„ìš”

### **ìš´ì˜ ì œí•œ**
- **í”„ë¡œë•ì…˜ í™˜ê²½**: ì¶”ê°€ ë³´ì•ˆ ì„¤ì • í›„ ì‚¬ìš© ê¶Œì¥
- **ê·œì • ì¤€ìˆ˜**: ë³´ì•ˆ ì •ì±…ì— ë”°ë¼ ì‚¬ìš© ì œí•œ ê°€ëŠ¥
- **ëª¨ë‹ˆí„°ë§**: ì™¸ë¶€ ì ‘ê·¼ì— ëŒ€í•œ ì§€ì†ì  ëª¨ë‹ˆí„°ë§ í•„ìš”

## ğŸ“ ì§€ì› ë° ë¬¸ì˜

í”„ë¡œì íŠ¸ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ íŒ€ì— ì—°ë½í•´ì£¼ì„¸ìš”.

---

**í”„ë¡œì íŠ¸**: hihypipe EKS ì¸í”„ë¼  
**í™˜ê²½**: Public Subnet êµ¬ì„±  
**ë²„ì „**: 1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2024ë…„ 8ì›” 23ì¼
