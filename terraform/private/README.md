# hihypipe EKS ì¸í”„ë¼ - Private Subnet êµ¬ì„±

## ğŸ“‹ ê°œìš”

ì´ í´ë”ëŠ” **Private Subnet ê¸°ë°˜ì˜ EKS í´ëŸ¬ìŠ¤í„°**ë¥¼ êµ¬ì„±í•˜ëŠ” Terraform ì½”ë“œì…ë‹ˆë‹¤. ë³´ì•ˆì„±ì´ ë†’ê³  ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ EKSë¥¼ ìš´ì˜í•˜ê³ ì í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
Internet
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bastion Host   â”‚ â† ë³„ë„ êµ¬ì„± í•„ìš”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VPC-APP                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Public Subnet  â”‚  â”‚      Private Subnets        â”‚  â”‚
â”‚  â”‚   (Bastion)     â”‚  â”‚   (EKS Nodes + Apps)       â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  Internet       â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  Gateway        â”‚  â”‚  â”‚   EKS Cluster       â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚                     â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â”‚  Node Group   â”‚  â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â”‚  (t3.medium)  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VPC-DB                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Private Subnets                        â”‚ â”‚
â”‚  â”‚              (Database Only)                        â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚              RDS Subnet Group               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚              (AZ-a, AZ-b)                   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ¨ ì£¼ìš” íŠ¹ì§•

### **ğŸ”’ ë³´ì•ˆ ì¤‘ì‹¬ ì„¤ê³„**
- **EKS ë…¸ë“œ**: Private Subnetì— ë°°ì¹˜
- **NAT Gateway**: ì™¸ë¶€ ì¸í„°ë„· ì ‘ê·¼ì„ ìœ„í•œ í†µë¡œ
- **VPC ê²©ë¦¬**: Appê³¼ DB VPC ì™„ì „ ë¶„ë¦¬
- **Bastion Host**: ë³„ë„ êµ¬ì„± í•„ìš” (ì´ ì½”ë“œì—ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŒ)

### **ğŸ’° ë¹„ìš© êµ¬ì¡°**
- **NAT Gateway**: í™œì„±í™” (ì‹œê°„ë‹¹ ë¹„ìš© ë°œìƒ)
- **EKS ë…¸ë“œ**: Private Subnet (ë³´ì•ˆì„± í–¥ìƒ)
- **VPC Endpoints**: ì„ íƒì  ì‚¬ìš©

### **ğŸŒ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±**
- **VPC-APP**: Public + Private Subnet
- **VPC-DB**: Private Subnetë§Œ (ì™„ì „ ê²©ë¦¬)
- **VPC Peering**: App â†” DB ê°„ í†µì‹ 
- **Route Tables**: ìë™ êµ¬ì„±

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
terraform_private/
â”œâ”€â”€ main.tf                    # VPC, Security Groups, VPC Peering
â”œâ”€â”€ eks.tf                     # EKS Cluster ë° Node Groups
â”œâ”€â”€ variables.tf               # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ outputs.tf                 # ì¶œë ¥ê°’ ì •ì˜
â”œâ”€â”€ terraform.tfvars.example   # ë³€ìˆ˜ ì˜ˆì‹œ íŒŒì¼
â”œâ”€â”€ README.md                  # ì´ íŒŒì¼
â””â”€â”€ EKS_DEPLOYMENT_ANALYSIS.md # ë°°í¬ ë¶„ì„ ë³´ê³ ì„œ
```

## ğŸš€ ì‹œì‘í•˜ê¸°

### **1. ì‚¬ì „ ìš”êµ¬ì‚¬í•­**
```bash
# AWS CLI ì„¤ì •
aws configure

# Terraform ì„¤ì¹˜ (>= 1.0)
terraform version
```

### **2. ë³€ìˆ˜ ì„¤ì •**
```bash
# ì˜ˆì‹œ íŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì •
cp terraform.tfvars.example terraform.tfvars

# terraform.tfvars íŒŒì¼ í¸ì§‘
vim terraform.tfvars
```

### **3. ë°°í¬ ì‹¤í–‰**
```bash
# ì´ˆê¸°í™”
terraform init

# ê³„íš í™•ì¸
terraform plan

# ë°°í¬ ì‹¤í–‰
terraform apply

# eksë§Œ ë°°í¬ ì‹¤í–‰
# variables.tfì— create_eks = true/false í™•ì¸
terraform apply -target=module.eks
```

### **4. EKS ì ‘ê·¼**
```bash
# kubeconfig ì—…ë°ì´íŠ¸
aws eks update-kubeconfig --region ap-northeast-2 --name hihypipe-cluster

# í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
kubectl get nodes
kubectl get pods --all-namespaces
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

### **ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­**
- **Bastion Host**: ë³„ë„ êµ¬ì„± í•„ìš” (ì´ ì½”ë“œì—ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŒ)
- **Private Subnet**: ì™¸ë¶€ì—ì„œ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€
- **NAT Gateway**: ë¹„ìš© ë°œìƒ (ì‹œê°„ë‹¹ ê³¼ê¸ˆ)

### **ğŸŒ ë„¤íŠ¸ì›Œí¬ ì œí•œì‚¬í•­**
- **ì™¸ë¶€ ì ‘ê·¼**: NAT Gatewayë¥¼ í†µí•´ì„œë§Œ ê°€ëŠ¥
- **EKS API**: Private Subnetì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
- **ì¸í„°ë„· ì—°ê²°**: NAT Gatewayë¥¼ í†µí•œ ìš°íšŒ í•„ìš”

### **ğŸ’° ë¹„ìš© ê³ ë ¤ì‚¬í•­**
- **NAT Gateway**: ì‹œê°„ë‹¹ ë¹„ìš© ë°œìƒ
- **ë°ì´í„° ì „ì†¡**: NAT Gatewayë¥¼ í†µí•œ íŠ¸ë˜í”½ ë¹„ìš©
- **EKS ë…¸ë“œ**: Private Subnet ë°°ì¹˜ë¡œ ë³´ì•ˆì„± í–¥ìƒ

## ğŸ”§ êµ¬ì„± ì˜µì…˜

### **VPC ì„¤ì •**
```hcl
# VPC-APP
enable_nat_gateway = true      # NAT Gateway í™œì„±í™”
single_nat_gateway = true      # ë‹¨ì¼ NAT Gateway (ë¹„ìš© ì ˆì•½)

# VPC-DB
create_igw = false             # Internet Gateway ë¹„í™œì„±í™”
enable_nat_gateway = false     # NAT Gateway ë¹„í™œì„±í™”
```

### **EKS ì„¤ì •**
```hcl
# Private Subnet ì‚¬ìš©
subnet_ids = module.vpc_app.private_subnets

# Public Endpoint ë¹„í™œì„±í™” (ê¸°ë³¸ê°’)
# endpoint_public_access = false
```

## ğŸ“Š ë¹„ìš© ì˜ˆìƒ

### **ì›”ë³„ ì˜ˆìƒ ë¹„ìš© (ap-northeast-2)**
- **NAT Gateway**: ~$45/ì›” (ì‹œê°„ë‹¹ $0.0625)
- **EKS ë…¸ë“œ (t3.medium)**: ~$30/ì›” Ã— ë…¸ë“œ ìˆ˜
- **ë°ì´í„° ì „ì†¡**: ì‚¬ìš©ëŸ‰ì— ë”°ë¼ ë³€ë™
- **ì´ ì˜ˆìƒ**: ~$75-150/ì›” (ë…¸ë“œ ìˆ˜ì— ë”°ë¼)

## ğŸš€ í™•ì¥ ë° ìˆ˜ì •

### **ë…¸ë“œ ê·¸ë£¹ ì¶”ê°€**
```hcl
eks_managed_node_groups = {
  app-nodes = {
    # ê¸°ì¡´ ì„¤ì •...
  }
  
  # ìƒˆë¡œìš´ ë…¸ë“œ ê·¸ë£¹ ì¶”ê°€
  worker-nodes = {
    ami_type       = "AL2023_x86_64_STANDARD"
    instance_types = ["t3.large"]
    min_size       = 2
    max_size       = 5
    desired_size   = 2
    subnet_ids     = module.vpc_app.private_subnets
  }
}
```

### **VPC Endpoints ì¶”ê°€**
```hcl
# í•„ìš”í•œ ê²½ìš° VPC Endpoints ì¶”ê°€
resource "aws_vpc_endpoint" "s3" {
  vpc_id       = module.vpc_app.vpc_id
  service_name = "com.amazonaws.${var.aws_region}.s3"
}
```

## ğŸ†š Public vs Private ë¹„êµ

| êµ¬ë¶„ | Private (ì´ êµ¬ì„±) | Public |
|------|-------------------|---------|
| **ë³´ì•ˆì„±** | ğŸ”’ ë†’ìŒ | âš ï¸ ë³´í†µ |
| **ë¹„ìš©** | ğŸ’° ë†’ìŒ (NAT Gateway) | ğŸ’° ë‚®ìŒ |
| **ì™¸ë¶€ ì ‘ê·¼** | ğŸ”„ NAT Gateway ìš°íšŒ | ğŸŒ ì§ì ‘ ì ‘ê·¼ |
| **ê´€ë¦¬ ë³µì¡ë„** | ğŸ”§ ë³µì¡ | ğŸŸ¢ ê°„ë‹¨ |
| **í”„ë¡œë•ì…˜ ì í•©ì„±** | âœ… ë†’ìŒ | âš ï¸ ë³´í†µ |

## ğŸ“ ì§€ì› ë° ë¬¸ì˜

í”„ë¡œì íŠ¸ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ íŒ€ì— ì—°ë½í•´ì£¼ì„¸ìš”.

---

**í”„ë¡œì íŠ¸**: hihypipe EKS ì¸í”„ë¼  
**í™˜ê²½**: Private Subnet êµ¬ì„±  
**ë²„ì „**: 1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2024ë…„ 8ì›” 23ì¼
